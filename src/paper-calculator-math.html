<!--
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
  <head>
    <link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="paper-calculator-math">

  <script src="jsep.js"></script>
  <script>
    
    Polymer({
	is: 'paper-calculator-math',
	properties: {
            expression: { notify: true },
            result: { notify: true }
	},
	evaluate: function(tree) {
	    switch (tree.type) {
	    case 'Literal':
		return tree.value;
	    case 'BinaryExpression':
		switch (tree.operator) {
		case '+': return this.evaluate(tree.left) + this.evaluate(tree.right);
		case '-': return this.evaluate(tree.left) - this.evaluate(tree.right);
		case '*': return this.evaluate(tree.left) * this.evaluate(tree.right);
		case '/': return this.evaluate(tree.left) / this.evaluate(tree.right);
		default: throw "unknown binary operator: "+tree.operator
		}
	    case 'UnaryExpression':
		switch (tree.operator) {
		case '-': return - this.evaluate(tree.argument);
		case '+': return + this.evaluate(tree.argument);
		default: throw "unknown unary operator: "+tree.operator
		}
		// case 'ConditionalExpression':
	    default:
		throw "unknown expression type: "+tree.type
	    }
	},
	eval: function () {
            var s = this.expression;
            s = s.replace(/\u00D7/g, '*').replace(/\u00F7/g, '/');
	    try {
		this.result = this.evaluate(jsep(s))
	    } catch(x) {
		console.log("this.evaluate(jsep(s)) => "+x)
		this.result = '?'
	    }
	}
    });
  </script>


</dom-module>
